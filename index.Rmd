---
title: "Disc Golf Elo Ratings"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(knitr)
library(shiny)
library(crosstalk)
library(DT)
library(plotly)
library(scales)
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=F)
testdata <- read.csv("EloDashData.csv")
testdata <- testdata[,-1]
testdata$Date<-as.Date(testdata$Date,format="%Y-%m-%d")
testdata$Year <- as.character(testdata$Year)
tdata <- SharedData$new(testdata)
rank <- read.csv("EloRank25.csv")
rank <- rank[,-1]
```

Top-25
======================================================================= 

Column {data-width=400}
-----------------------------------------------------------------------

### Top-25 Players in Elo Rating

```{r}
datatable(rank,
          class = "compact cell-border",
          rownames = FALSE,
          options = list(order = list(1, "desc"),
                         autoWidth = FALSE,
                         pageLength = 25))
```


Column {data-width=600}
-----------------------------------------------------------------------

### Bar Chart of Top-25 Players (float cursor over bars for more info)

```{r}
q <- ggplot(rank,aes(x=reorder(Name,-Elo),y=Elo,color=Name)) + 
  geom_bar(stat="identity")+
  coord_cartesian(ylim=c((min(rank$Elo)-100),(max(rank$Elo)+50)))+
  xlab("Player")+
  theme(axis.text.x=element_blank())

ggplotly(q,tooltip = c("y", "Name"))%>%
    layout(showlegend = F)
```

### Methodology

[Elo Ratings](https://en.wikipedia.org/wiki/Elo_rating_system#:~:text=The%20Elo%20rating%20system%20is,a%20Hungarian%2DAmerican%20physics%20professor.) were invented by Physicist Arpad Elo in the mid-twentieth century as a way to measure the relative skill of chess players.  They are now used for a wide variety of sports (including esports).

Elo ratings were originally designed for measuring players of one-on-one sports.  However, I have been working since ~2017 to modify the metric for disc golf (see [this article](https://discgolf.ultiworld.com/2018/02/13/introducing-2017-disc-golf-elo-ratings/) for more details).

The two equations below, which I use for this metric, are pretty much the standard Elo equations.  *ES* stands for expected score, *S* is actual score, and *K* is the k-factor, which is a multiplier for the amount a rating will change per event.  I am currently using a k-factor of 40.

$$ Elo_i=Elo_{i-1}-K*MS*(S-ES)$$
$$ES=\frac{1}{(10^{-(Elo_n-\overline{Elo})/400}+1)}$$

MS stands for margin stabilizer, which is an additional (and novel) multiplier that influences how much ratings change per event.  However, the multiplier value if different for each player based on how said player's rating compares to the average rating of the field.  If a players rating is low, a very good round will cause their rating to go up a lot, but a bad round will not cause their rating to decrease.  The opposite is true for players with high ratings.  So it has the largest effect at the margins, hence the name.

$$MS=[e^{S-ES}]^{-(Elo_n-\overline{Elo})/100}$$


Data Exploration
=======================================================================

Inputs {.sidebar}
-----------------------------------------------------------------------

```{r}
filter_select("Name", "Choose Player", tdata, ~Name)
```

```{r}
filter_select("Year", "Choose Year", tdata, ~Year)
```


Column {data-width=400}
-----------------------------------------------------------------------

### Table of Elo Ratings by Player, Event, Year, and Date

```{r}
datatable(tdata,
          class = "compact cell-border",
          rownames = FALSE,
          options = list(order = list(1, "desc"),
                         autoWidth = FALSE,
                         pageLength = 20))
```

Column {data-width=600}
-----------------------------------------------------------------------

### Plot of Top-25 Players Over Time

```{r}
g <- ggplot(tdata,aes(as.Date(Date),Elo,group=Name)) + 
  geom_line(aes(color=Name)) +
  scale_x_date(date_labels = "%Y")+
  xlab("Date")

ggplotly(g,tooltip = c("x", "y", "group"))%>%
    layout(showlegend = F)
```


###